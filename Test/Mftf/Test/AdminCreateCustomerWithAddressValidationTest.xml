<?xml version="1.0" encoding="UTF-8"?>

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
       <test name="AdminCreateCustomerWithAddressValidationTest">
              <annotations>
                   <stories value="Address Validations"/>
                   <title value="Create customer and address, from USA | Owner:Vaishali Dhake"/>
                   <description value="Login as admin and create customer and validate address"/>
                   <severity value="MAJOR"/>
                   <testCaseId value="3757271"/>
                   <group value="avatax_address_validation"/>
              </annotations>

              <before>
                     <!-- Admin login -->
                     <actionGroup ref="AdminLoginActionGroup" stepKey="loginToAdminPanel"/>
                     <!-- enable address validation -->
                     <actionGroup ref="AdminGoToSalesTaxConfigurationPageActionGroup" stepKey="openSalesTaxConfigurationPage"/>
                     <actionGroup ref="AdminEnableAddressValidationActionGroup" stepKey="enableAddressValidation"/>
                                          
                     <createData entity="Simple_Customer_Without_Address" stepKey="createCustomer"/>
              </before>
              <after>
                     <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
                     <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
              </after>

              <!--Filter the customer From grid-->
              <actionGroup ref="AdminFilterCustomerByEmail" stepKey="filterTheCustomerByEmail">
                     <argument name="email" value="$$createCustomer.email$$"/>
              </actionGroup>
              <actionGroup ref="AdminClickFirstRowEditLinkOnCustomerGridActionGroup" stepKey="clickOnEditButton"/>
              <click selector="{{AdminEditCustomerAddressesSection.addresses}}" stepKey="selectAddress"/>
              <waitForPageLoad stepKey="waitForAddressPageToLoad"/>
              <click selector="{{AdminEditCustomerAddressesSection.addNewAddress}}" stepKey="ClickOnAddNewAddressButton"/>
              <waitForPageLoad stepKey="waitForNewAddressPageToLoad"/>
              <checkOption selector="{{AdminCustomerAddressesSection.defaultBillingAddress}}" stepKey="EnableDefaultBillingAddress"/>
              <fillField userInput="{{Ava_US_Address_CA.street[0]}}" selector="{{AdminCustomerAddressesSection.streetAddress}}" stepKey="fillStreet"/>
              <fillField userInput="{{Ava_US_Address_CA.city}}" selector="{{AdminCustomerAddressesSection.city}}" stepKey="fillCity"/>
              <click selector="{{AdminCustomerAddressesSection.country}}" stepKey="clickCountryToOpenListOfCountries"/>
              <click selector="{{AdminCustomerAddressesSection.countryId(Ava_US_Address_CA.country_id)}}" stepKey="fillCountry"/>
              <fillField userInput="{{Ava_US_Address_CA.postcode}}" selector="{{AdminCustomerAddressesSection.zip}}" stepKey="fillPostcode"/>
              <click selector="{{AdminCustomerAddressesSection.region}}" stepKey="clickRegionToOpenListOfRegions"/>
              <click selector="{{AdminCustomerAddressesSection.regionId(Ava_US_Address_CA.state)}}" stepKey="fillRegion"/>
              <scrollTo selector="{{AdminEditCustomerAddressesSection.phone}}" x="0" y="-80" stepKey="scrollToPhone"/>
              <fillField selector="{{AdminEditCustomerAddressesSection.phone}}" userInput="{{US_Address_CA.telephone}}" stepKey="fillPhoneNumber"/>
              <waitForPageLoad stepKey="waitForAddresses"/>
              <click selector="{{AvaAdminCustomerAddressesSection.validateAddress}}" stepKey="avaclickValidateAddressOnAddUpdateAddressForm"/>
              <waitForPageLoad stepKey="waitForNewAddressIsCreated"/>
              <seeElement selector="{{AvaAdminCustomerAddressesSection.avaaddress}}" stepKey="seeValidAddress"/>
              <see userInput="Suggested Address" selector="{{AvaAdminCustomerAddressesSection.avaaddress}}" stepKey="assertValidAddressSuggested"/>
       </test>
</tests>