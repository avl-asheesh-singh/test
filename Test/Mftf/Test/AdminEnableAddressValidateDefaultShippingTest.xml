<?xml version="1.0" encoding="UTF-8"?>

<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
       <test name="AdminEnableAddressValidateDefaultShippingTest">
              <annotations>
                     <stories value="Address Validations"/>
                     <title value="validate default shipping address when AvaTax - Address Validation is enabled | Owner:Vaishali Dhake"/>
                     <description value="Login as admin, validate default shipping address when AvaTax - Address Validation is enabled"/>
                     <severity value="MAJOR"/>
                     <testCaseId value="3876907"/>
                     <group value="avatax_address_validation"/>
              </annotations> 

              <before>
                     <actionGroup ref="AdminLoginActionGroup" stepKey="loginToAdminPanel"/>

                     <!-- enable address validation -->
                     <actionGroup ref="AdminGoToSalesTaxConfigurationPageActionGroup" stepKey="openSalesTaxConfigurationPage"/>
                     <actionGroup ref="AdminEnableAddressValidationActionGroup" stepKey="enableAddressValidation"/>

                     <createData entity="Simple_US_Customer_Multiple_Addresses" stepKey="createCustomer"/>
              </before>

              <after>
                     <deleteData createDataKey="createCustomer" stepKey="deleteCustomer"/>
                     <actionGroup ref="AdminLogoutActionGroup" stepKey="logout"/>
              </after>

              <!--Filter the customer From grid-->
              <actionGroup ref="AdminOpenCustomersGridActionGroup" stepKey="openCustomersGridPage"/>
              <actionGroup ref="OpenEditCustomerFromAdminActionGroup" stepKey="openEditCustomerPage">
                     <argument name="customer" value="Simple_US_Customer_Multiple_Addresses"/>
              </actionGroup>
              <click selector="{{AdminEditCustomerInformationSection.addresses}}" stepKey="openAddressesTab"/>
              <waitForPageLoad stepKey="waitForAddresses"/>
              <conditionalClick selector="{{AdminCustomerAddressFiltersSection.clearAll}}" dependentSelector="{{AdminCustomerAddressFiltersSection.clearAll}}" visible="true" stepKey="clickOnButtonToRemoveFiltersIfPresent"/>
              <seeElement selector="{{AdminCustomerAddressesDefaultShippingSection.addressDetails}}" stepKey="seeDefaultShippingAddressSectionBeforeChangingDefaultAddress"/>
              <click selector="{{AdminCustomerAddressesDefaultShippingSection.editButton}}" stepKey="clickEditForDefaultShippingAddress"/>
              <waitForPageLoad stepKey="waitForDefaultShippingAddresses"/>
              <click selector="{{AvaAdminCustomerAddressesSection.validateAddress}}" stepKey="avaclickValidateAddressOnAddUpdateAddressForm"/>
              <waitForPageLoad stepKey="waitForValidateAddress"/>
              <seeElement selector="{{AvaAdminCustomerAddressesSection.avaaddress}}" stepKey="seeValidAddress"/>
              <see userInput="Suggested Address" selector="{{AvaAdminCustomerAddressesSection.avaaddress}}" stepKey="assertValidAddressSuggested"/>
       </test>
</tests>